if not game:IsLoaded() then
    game.Loaded:Wait()
end

local TextChatService = game:GetService("TextChatService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local StarterGui = game:GetService("StarterGui")

local function ensureHasExecuted()
    local hasExecuted = LocalPlayer:FindFirstChild("HasExecuted")
    if not hasExecuted then
        hasExecuted = Instance.new("BoolValue")
        hasExecuted.Name = "HasExecuted"
        hasExecuted.Value = false
        hasExecuted.Parent = LocalPlayer
    end
    return hasExecuted
end

local function ensureChatEnabled(maxAttempts)
    local attempts = 0
    repeat
        StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.Chat, true)
        task.wait(0.1)
        attempts += 1
    until StarterGui:GetCoreGuiEnabled(Enum.CoreGuiType.Chat) or attempts >= maxAttempts
end

local function showNotification(title, description, imageId)
    if StarterGui then
        StarterGui:SetCore("SendNotification", {
            Title = title;
            Text = description;
            Icon = imageId;
            Duration = 15;
        })
    end
end

if TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
    local hasExecuted = ensureHasExecuted()

    if not hasExecuted.Value then
        local startTime = tick()
        hasExecuted.Value = true
        print("Executing ACL script...")

        if setfflag then
            pcall(function()
                setfflag("AbuseReportScreenshot", "False")
                setfflag("AbuseReportScreenshotPercentage", "0")
            end)
        end

        TextChatService.OnIncomingMessage = function(message)
            if message.Text:sub(1, 2) == "/e" then
                return message.Text
            else
                message.Text = message.Text .. ""
            end
        end

        task.spawn(function()
            ensureChatEnabled(10)
        end)

        local ACLloadTime = tick() - startTime
        print(string.format("ACL successfully loaded in %.2f seconds!", ACLloadTime))
        showNotification("ACL Script", string.format("Loaded in %.2f seconds!", ACLloadTime), "rbxassetid://123456")

    else
        print("ACL already loaded!")
        showNotification("ACL Script", "Already loaded!", "rbxassetid://123456")
    end
else
    loadstring(game:HttpGet("https://gitlab.com/DDSoftworks/D-Projects/-/raw/main/DACL"))()
end

task.spawn(function()
    repeat
        StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.Chat, true)
        task.wait()
    until StarterGui:GetCoreGuiEnabled(Enum.CoreGuiType.Chat)
end)